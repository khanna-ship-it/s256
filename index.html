<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server 256: Command Nexus - Data Feed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700;900&family=Inter:wght@400;600;800&display=swap');
        body {
            font-family: 'Merriweather', serif;
            background-color: #2b3531; 
            color: #d1d5db; 
            min-height: 100vh;
            padding-bottom: 3rem;
        }

        .game-header {
            font-family: 'Inter', sans-serif;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.6);
        }

        .game-card {
            background-color: #3f4a46; 
            border: 2px solid #58655e; 
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
            border-radius: 0.75rem;
            transition: all 0.2s ease;
        }

        /* Navigation */
        .nav-btn {
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            background-color: #58655e;
            border-bottom: 3px solid #3f4a46;
            transition: all 0.1s ease;
            color: #d1d5db;
        }
        .nav-btn:hover {
            background-color: #6a7972;
            color: #f3f4f6;
        }
        .nav-btn.active {
            background-color: #10b981; 
            color: #1f2937;
            border-bottom: 3px solid #10b981;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
        }

        /* Ranking Accents */
        .ranking-row {
            transition: background-color 0.1s;
        }
        .ranking-row:hover {
            background-color: #4a5752;
        }

        .ranking-list > .ranking-row:nth-child(odd) { background-color: #3f4a46; }
        .ranking-list > .ranking-row:nth-child(even) { background-color: #36403c; }

        .ranking-list.power > .ranking-row:nth-child(1) { border-left: 5px solid #ffcc00; }
        .ranking-list.power > .ranking-row:nth-child(1) .rank-number { color: #ffcc00; }
        .ranking-list.power > .ranking-row:nth-child(2) { border-left: 5px solid #cccccc; }
        .ranking-list.power > .ranking-row:nth-child(2) .rank-number { color: #cccccc; }
        .ranking-list.power > .ranking-row:nth-child(3) { border-left: 5px solid #cd7f32; }
        .ranking-list.power > .ranking-row:nth-child(3) .rank-number { color: #cd7f32; }

        .rank-number {
            font-size: 1.2rem;
            font-weight: 800;
            min-width: 30px;
            text-align: center;
            font-family: 'Inter', sans-serif;
        }

        .input-game {
            background-color: #2b3531;
            border: 1px solid #58655e;
            color: #e5e7eb;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.3s;
        }
        .input-game:focus {
            border-color: #10b981; 
            box-shadow: 0 0 0 1px #10b981;
            outline: none;
        }
    </style>
</head>
<body>
    <div class="max-w-6xl mx-auto p-4 md:p-8">
    
        <header class="text-center mb-6">
            <h1 class="text-5xl md:text-6xl font-extrabold mb-1 game-header uppercase text-green-400">
                Migrate to Server 256
            </h1>
            <p class="text-xl font-light text-gray-400 game-header">
                The Land of Utopia
            </p>
        </header>

        <nav class="flex justify-center mb-8 game-card p-2">
            <button id="nav-about" onclick="showView('about-view')" class="nav-btn px-4 py-2 mx-2 rounded-lg">
                About Server
            </button>
            <button id="nav-migration" onclick="showView('migration-view')" class="nav-btn px-4 py-2 mx-2 rounded-lg">
                Migration Status
            </button>
            <button id="nav-ranking" onclick="showView('ranking-view')" class="nav-btn active px-4 py-2 mx-2 rounded-lg">
                Power Ranking
            </button>
        </nav>
        
        <div class="text-center mb-6">
            <div id="auth-status-bar" class="inline-flex items-center text-sm px-4 py-2 rounded-full game-card border border-green-500/50">
                <div id="auth-status-light" class="w-3 h-3 rounded-full mr-2 bg-yellow-400 animate-pulse"></div>
                <p id="auth-status" class="text-gray-300 mr-4 font-semibold">Establishing Connection...</p>
                <p id="user-id-display" class="text-xs text-gray-400 truncate">Commander ID: N/A</p>
            </div>
        </div>

        <div id="about-view" class="hidden game-card p-6">
            <h2 class="text-3xl font-bold mb-4 text-green-400 border-b border-gray-600 pb-2 font-serif">
                Realm Overview
            </h2>
            <p class="mb-4 text-gray-300">
                
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server 256: UTOPIA Recruitment</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a; /* Dark background */
            color: #f0f0f0; /* Light text */
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #2c2c2c;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        }
        h1, h2, h3 {
            color: #ffd700; /* Gold color for headings */
            text-align: center;
            border-bottom: 2px solid #444;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        .intro-banner {
            text-align: center;
            margin-bottom: 30px;
        }
        .intro-banner p {
            font-size: 1.2em;
            font-weight: bold;
            color: #ff4500; /* Orange-red for key phrases */
            margin: 5px 0;
        }
        .section-header {
            font-size: 1.5em;
            color: #ffd700;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        ul li {
            background: #3a3a3a;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 5px;
            border-left: 5px solid #00bfff; /* Blue accent */
        }
        .call-to-action {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background-color: #444;
            border-radius: 8px;
        }
        .call-to-action a {
            display: inline-block;
            background-color: #ff4500;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 5px;
            font-size: 1.3em;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .call-to-action a:hover {
            background-color: #e63900;
        }
        .server-description {
            text-align: center;
            font-style: italic;
            margin-bottom: 30px;
        }
        /* Style for foreign language text */
        .language-text {
            font-size: 1.1em;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="intro-banner">
        <p class="language-text">Buraya gelip bize destek verin pi√ßler!</p>
        <p class="language-text">Ê¨¢ËøéÂä†ÂÖ•Êàë‰ª¨Ôºå‰∏≠ÂõΩÈæôÔºÅ</p>
    </div>

    <h1>‚öîÔ∏è Join the Elite: Server 256 - The Ultimate War Experience!</h1>

    <p class="server-description">
        Server 256, known as **UTOPIA**, is a **mature kingdom** ruled by the strongest alliances. This is a **peaceful and balanced** server. New commanders are advised to seek alliance membership immediately upon entry.
    </p>

    <p style="text-align: center; font-size: 1.1em; font-weight: bold; margin-top: 20px;">
        Are you an active, **efficient fighter** craving decisive KVK victories and a shot at the top? Look no further than Server 256!
    </p>

    <p style="text-align: center; margin-bottom: 30px;">
        We are a highly competitive server with a clear focus on **Merits Efficiency** and an expectation of high commitment. Join us and be part of a server that fights smarter and harder.
    </p>

    <h2>üõ°Ô∏è Why Server 256 is Your Next Home</h2>
    <ul>
        <li>
            <strong style="color: #ffd700;">Dominant Alliances:</strong> Our strength is anchored by **[IW1]** and **[DS]**, the two powerhouse alliances driving the server's success (as seen in the Merits Efficiency Ranking). Our coordinated effort ensures **maximum impact** in every battle.
        </li>
        <li>
            <strong style="color: #ffd700;">Merit-Driven Culture:</strong> We prize **efficiency and activity** above all. Your individual performance and contribution to server metrics like the **Merits/Power Ratio** are key to your success and recognition here.
        </li>
        <li>
            <strong style="color: #ffd700;">Truly Global Community:</strong> Connect with warriors worldwide on our fully functional **International Discord Server**. We offer language integration to ensure everyone can communicate, strategize, and thrive.
        </li>
        <li>
            <strong style="color: #ffd700;">Organised Conquests:</strong> Never miss a battle! Our Trojan, Marauder Hunt, and Treasure Hunt events run on a clear, **predictable weekly cycle**.
        </li>
        <li>
            <strong style="color: #ffd700;">Comprehensive Coverage:</strong> We consistently host and cover Wonders, BOD, and more across our allied alliances, ensuring **full map dominance**.
        </li>
        <li>
            <strong style="color: #ffd700;">Stellar Glory Supremacy:</strong> We boast a vast amount of wins in the serious, high-level Stellar Glory competition.
        </li>
        <li>
            <strong style="color: #ffd700;">Automated Buffs:</strong> Enjoy maximum efficiency with our **Automated Buff Bot** for Imperial City Buffs. Simply request your time and date on Discord, and we handle the rest, letting you focus **purely on the fight!**
        </li>
    </ul>

    <h2>üöÄ Your Next Conquest Starts Here</h2>

    <p style="text-align: center;">
        We are actively recruiting players who are not just powerful, but who **live and breathe activity and fighting with efficiency**. We pride ourselves on our KVK prowess and expect **total commitment** to the battle. Prove yourself and join the legions of Server 256!
    </p>

    <div class="call-to-action">
        <p style="font-size: 1.1em; margin-bottom: 15px;">
            Ready to Migrate? For full details and immediate access to our specialized Migration Discord server, please message:
        </p>
        <a href="https://discordapp.com/users/mk11shard" target="_blank">Message @mk11shard on Discord Today!</a>
    </div>

</div>

</body>
</html>

                
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                <div class="p-3 bg-gray-700/30 rounded">
                    <h3 class="font-bold text-yellow-300">Server Age:</h3> 115 Days
                </div>
                <div class="p-3 bg-gray-700/30 rounded">
                    <h3 class="font-bold text-yellow-300">Dominant Alliances:</h3> [IW1] IronWraiths and [DS] DragonSoul
                </div>
                <div id="supabase-status-display" class="p-3 bg-gray-700/30 rounded">
                    <h3 class="font-bold text-yellow-300">Supabase Connection:</h3> <span class="text-gray-400">Checking...</span>
                </div>
            </div>
            <p class="mt-4 text-xs text-gray-500">
                Data is updated by the Command Nexus Administrator. All rankings are real-time.
            </p>
        </div>

        <div id="migration-view" class="hidden game-card p-6">
            <h2 class="text-3xl font-bold mb-4 text-green-400 border-b border-gray-600 pb-2 font-serif">
                Server Migration Watch
            </h2>
            
            <p class="text-gray-300 mb-4">
                This table tracks recent inbound and outbound migration activity as logged by commanders (read-only data feed).
            </p>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-600 text-sm">
                    <thead>
                        <tr class="text-left text-gray-400 uppercase tracking-wider bg-gray-700/50">
                            <th class="p-3 font-semibold">Commander</th>
                            <th class="p-3 font-semibold">Server ID</th>
                            <th class="p-3 font-semibold">Direction</th>
                            <th class="p-3 font-semibold">Time Logged</th>
                        </tr>
                    </thead>
                    <tbody id="migration-status-body" class="divide-y divide-gray-700/70 ranking-list">
                        <tr><td colspan="4" class="p-4 text-center text-yellow-300">Awaiting data transmission...</td></tr>
                    </tbody>
                </table>
            </div>
            <form id="migration-form" class="hidden"></form>
            <div id="migration-message-box" class="hidden"></div>
            <button id="migration-submit-btn" class="hidden"></button>
        </div>


        <div id="ranking-view" class="game-card p-6">
            <h2 class="text-3xl font-bold mb-4 text-green-400 border-b border-gray-600 pb-2 font-serif">
                Power Ranking
            </h2>
            
            <form id="ranking-form" class="hidden"></form>
            <div id="message-box" class="hidden"></div>
            <button id="submit-btn" class="hidden"></button>
            
            <h3 class="text-xl font-bold mb-3 text-gray-300 flex justify-between items-center">
                Live Data Feed
                <input type="text" id="search-input" placeholder="Search Commander or Alliance..." class="w-full md:w-64 p-2 rounded-lg input-game text-sm">
            </h3>
            
            <div class="grid grid-cols-12 text-xs font-semibold uppercase tracking-wider text-gray-400 p-3 border-y border-gray-600 bg-gray-700/50">
                <div class="col-span-1 flex items-center justify-center">Rank</div>
                <div class="col-span-3">Commander</div>
                <div class="col-span-2 cursor-pointer sort-header flex items-center hover:text-green-400 transition" id="sort-alliance" data-sort-key="alliance">
                    Alliance
                    <span class="sort-icon-asc ml-1 text-xs opacity-30">‚ñ≤</span>
                    <span class="sort-icon-desc text-xs opacity-30">‚ñº</span>
                </div>
                <div class="col-span-2 cursor-pointer sort-header flex items-center hover:text-green-400 transition" id="sort-ratio" data-sort-key="merits_power_ratio">
                    Ratio
                    <span class="sort-icon-asc ml-1 text-xs opacity-30">‚ñ≤</span>
                    <span class="sort-icon-desc text-xs opacity-30">‚ñº</span>
                </div>
                <div class="col-span-2 cursor-pointer sort-header flex items-center hover:text-green-400 transition" id="sort-merits" data-sort-key="total_merits">
                    merits (M)
                    <span class="sort-icon-asc ml-1 text-xs opacity-30">‚ñ≤</span>
                    <span class="sort-icon-desc text-xs opacity-30">‚ñº</span>
                </div>
                <div class="col-span-2 cursor-pointer sort-header flex items-center hover:text-green-400 transition" id="sort-power" data-sort-key="total_power">
                    Power (M)
                    <span class="sort-icon-asc ml-1 text-xs opacity-30">‚ñ≤</span>
                    <span class="sort-icon-desc text-xs opacity-30">‚ñº</span>
                </div>
            </div>

            <div id="rankings-container" class="ranking-list power divide-y divide-gray-700/70">
                <p class="p-4 text-center text-yellow-300" id="loading-message">Connecting to the Great Library...</p>
            </div>
        </div>

    </div>


    <script type="module">

        // --- SUPABASE SETUP (CLEANED) ---
        // 1. Single Import
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

        const supabaseUrl = 'https://jkgtdjoqqsxzcnoioedm.supabase.co';
        // 2. Hardcoded Public Key (Essential for browser access)
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImprZ3Rkam9xcXN4emNub2lvZWRtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5MjU3NTIsImV4cCI6MjA3NzUwMTc1Mn0.a3ZtPetBm8s5GwBsB5vpZesDEt4ujhWZ6Kme0qyw_bE'; 
        
        // 3. Single Client Initialization
        const supabase = createClient(supabaseUrl, supabaseKey);

        const RANKING_TABLE_NAME = '256-rankings'; 
        // Note: Assuming a table named 'migration_logs' for the other tab
        const MIGRATION_TABLE_NAME = 'migration_logs'; 
        
        // --- CORE DATA FETCHING FUNCTION ---
        async function getRankings() {
            const statusDisplay = document.querySelector('#supabase-status-display span');
            if(statusDisplay) statusDisplay.textContent = 'Loading...';

            // Selecting the columns by name as per your database schema
            const { data, error } = await supabase
                .from(RANKING_TABLE_NAME) 
                .select(`rank_rank, commander_name, alliance, merits_power_ratio, total_merits, total_power`); 

            if (error) {
                console.error('SUPABASE FETCH ERROR:', error);
                const el = document.getElementById('rankings-container');
                if(el) el.innerHTML = `<p class="p-4 text-center text-red-400">CRITICAL: Supabase connection failed. ${error.message}.</p>`;
                if(statusDisplay) statusDisplay.innerHTML = '<span class="text-red-400 font-bold">CRITICAL ERROR</span>';
                return [];
            }
            
            if(statusDisplay) statusDisplay.innerHTML = '<span class="text-green-400 font-bold">CONNECTED</span>';
            return data;
        }


        // --- UI ELEMENTS & UTILITY FUNCTIONS ---
        const views = ['about-view', 'migration-view', 'ranking-view'];
        const rankingsContainerEl = document.getElementById('rankings-container');
        const searchInputEl = document.getElementById('search-input');
        const migrationStatusBodyEl = document.getElementById('migration-status-body');
        
        // Use document.getElementById for all elements to be safe
        const sortAllianceEl = document.getElementById('sort-alliance');
        const sortRatioEl = document.getElementById('sort-ratio');
        const sortMeritsEl = document.getElementById('sort-merits'); 
        const sortPowerEl = document.getElementById('sort-power'); 

        let allRankings = []; 
        let sortState = { key: 'total_power', direction: 'desc' }; 


        window.showView = (viewId) => {
            views.forEach(id => {
                const element = document.getElementById(id);
                const navBtn = document.getElementById(`nav-${id.split('-')[0]}`);
                if (element && navBtn) {
                    if (id === viewId) {
                        element.classList.remove('hidden');
                        navBtn.classList.add('active');
                        // Fetch/render migration data when its tab is clicked
                        if (id === 'migration-view') {
                             fetchAndRenderMigrations();
                        }
                    } else {
                        element.classList.add('hidden');
                        navBtn.classList.remove('active');
                    }
                }
            });
        };
        
        /** Fetches and Renders Migration Logs (One-time fetch for simplicity) */
        const fetchAndRenderMigrations = async () => {
            migrationStatusBodyEl.innerHTML = '<tr><td colspan="4" class="p-4 text-center text-yellow-300">Fetching migration logs...</td></tr>';
            
            const { data, error } = await supabase
                .from(MIGRATION_TABLE_NAME) 
                .select(`commander, server, direction, created_at`)
                .order('created_at', { ascending: false });

            if (error || !data) {
                migrationStatusBodyEl.innerHTML = `<tr><td colspan="4" class="p-4 text-center text-red-400">Error fetching migration log.</td></tr>`;
                return;
            }

            migrationStatusBodyEl.innerHTML = '';

            if (data.length === 0) {
                migrationStatusBodyEl.innerHTML = '<tr><td colspan="4" class="p-4 text-center text-gray-500">No migration events logged yet.</td></tr>';
                return;
            }

            data.forEach(log => {
                const directionClass = log.direction === 'INBOUND' ? 'text-green-400' : 'text-red-400';
                
                const logTime = new Date(log.created_at).toLocaleTimeString('en-US', {
                    hour: '2-digit', minute: '2-digit'
                }) + ' ' + new Date(log.created_at).toLocaleDateString('en-US', {
                    month: 'short', day: 'numeric'
                });

                const rowHtml = `
                    <tr class="ranking-row transition duration-150">
                        <td class="p-3 font-semibold text-white truncate">${log.commander || 'N/A'}</td>
                        <td class="p-3 text-gray-300">${log.server || 'N/A'}</td>
                        <td class="p-3 font-bold ${directionClass}">${log.direction || 'N/A'}</td>
                        <td class="p-3 text-gray-400 text-xs">${logTime}</td>
                    </tr>
                `;
                migrationStatusBodyEl.innerHTML += rowHtml;
            });
        };

        
        /** Renders the list of rankings */
        const renderRankings = (rankings) => {
            
            const sortedRankings = [...rankings].sort((a, b) => {
                const aVal = a[sortState.key] || 0;
                const bVal = b[sortState.key] || 0;

                // Handle numeric vs string comparison
                if (typeof aVal === 'string' || typeof bVal === 'string') {
                    if (aVal < bVal) return sortState.direction === 'asc' ? -1 : 1;
                    if (aVal > bVal) return sortState.direction === 'asc' ? 1 : -1;
                } else {
                    if (parseFloat(aVal) < parseFloat(bVal)) return sortState.direction === 'asc' ? -1 : 1;
                    if (parseFloat(aVal) > parseFloat(bVal)) return sortState.direction === 'asc' ? 1 : -1;
                }
                
                // Secondary sort by Commander Name
                if (a.commander_name < b.commander_name) return -1;
                if (a.commander_name > b.commander_name) return 1;
                return 0; 
            });

            rankingsContainerEl.innerHTML = '';
            
            if (sortedRankings.length === 0) {
                rankingsContainerEl.innerHTML = '<p class="p-4 text-center text-gray-500">No matching commanders found in the Registry.</p>';
                return;
            }

            // Update header arrows
            const sortHeaders = [sortPowerEl, sortMeritsEl, sortAllianceEl, sortRatioEl].filter(Boolean); // Filter out nulls
            sortHeaders.forEach(el => {
                el.querySelectorAll('span').forEach(span => span.classList.remove('opacity-100', 'text-green-400'));
                el.querySelectorAll('span').forEach(span => span.classList.add('opacity-30'));

                if (el.dataset.sortKey === sortState.key) {
                    const iconClass = sortState.direction === 'asc' ? '.sort-icon-asc' : '.sort-icon-desc';
                    el.querySelector(iconClass).classList.remove('opacity-30');
                    el.querySelector(iconClass).classList.add('opacity-100', 'text-green-400');
                }
            });


            // Render rows
            sortedRankings.forEach((rank, index) => {
                const rankNumber = rank.rank_rank || index + 1;
                
                const rankEl = document.createElement('div');
                rankEl.className = 'ranking-row grid grid-cols-12 items-center p-3 text-sm transition duration-150'; 
                
                const formatMillions = (value) => {
                    const num = parseFloat(value) || 0;
                    return (num / 1000000).toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 }) + 'M';
                };
                
                const formatRatio = (value) => {
                    const num = parseFloat(value) || 0;
                    return num.toFixed(3);
                };

                let content = `
                    <div class="col-span-1 flex items-center justify-center">
                        <span class="rank-number text-gray-400">${rankNumber}</span>
                    </div>
                    <div class="col-span-3 font-bold text-white truncate">
                        ${rank.commander_name || 'N/A'}
                    </div>
                    <div class="col-span-2 text-cyan-400 font-inter truncate">${rank.alliance || 'N/A'}</div>
                    <div class="col-span-2 text-gray-300 font-inter">${formatRatio(rank.merits_power_ratio)}</div>
                    <div class="col-span-2 text-red-400 font-inter">${formatMillions(rank.total_merits)}</div>
                    <div class="col-span-2 text-yellow-300 font-inter">${formatMillions(rank.total_power)}</div>
                `;

                rankEl.innerHTML = content;
                rankingsContainerEl.appendChild(rankEl);
            });
        };

        
        /** Applies filter (search) and sort, then calls renderRankings */
        const applyFiltersAndSort = () => {
            const searchTerm = searchInputEl.value.toLowerCase().trim();
            
            const filteredRankings = allRankings.filter(rank => 
                (rank.commander_name?.toLowerCase().includes(searchTerm)) ||
                (rank.alliance?.toLowerCase().includes(searchTerm))
            );

            renderRankings(filteredRankings);
        };


        // --- Event Listeners for Filtering and Sorting ---
        searchInputEl.addEventListener('input', applyFiltersAndSort);

        const handleSortClick = (event) => {
            const newKey = event.currentTarget.dataset.sortKey;
            
            let newDirection = (newKey === 'total_power' || newKey === 'total_merits' || newKey === 'merits_power_ratio') ? 'desc' : 'asc';

            if (sortState.key === newKey) {
                sortState.direction = sortState.direction === 'desc' ? 'asc' : 'desc';
            } else {
                sortState.key = newKey;
                sortState.direction = newDirection;
            }

            applyFiltersAndSort();
        };
        
        // Add listeners only if elements exist
        if(sortPowerEl) sortPowerEl.addEventListener('click', handleSortClick);
        if(sortMeritsEl) sortMeritsEl.addEventListener('click', handleSortClick);
        if(sortAllianceEl) sortAllianceEl.addEventListener('click', handleSortClick);
        if(sortRatioEl) sortRatioEl.addEventListener('click', handleSortClick);


        // --- APPLICATION START ---
        window.onload = async () => {
            // 1. Update system status
            document.getElementById('auth-status').textContent = 'SECURE LINK: ACTIVE (READ-ONLY)';
            document.getElementById('auth-status-light').classList.replace('bg-yellow-400', 'bg-green-500');
            document.getElementById('auth-status-light').classList.remove('animate-pulse');
            document.getElementById('user-id-display').textContent = 'Commander ID: ANONYMOUS';
            
            // 2. Set default view and fetch rankings data
            showView('ranking-view'); // Default to the ranking view
            
            try {
                const data = await getRankings();
                allRankings = data;
                applyFiltersAndSort(); 
                document.getElementById('loading-message')?.remove();
            } catch (e) {
                console.error("Initial load failed:", e);
                // Error message handled in getRankings
            }
        };

    </script>
</body>
</html>
